<!doctype html><html>
<head>
<title>
Weixin-minis :: My New Hugo Site
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2021-09-07T07:28:50 UTC">
<meta name=description content>
<title>Weixin-minis :: My New Hugo Site</title>
<link rel="shortcut icon" href=/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/layout.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/css/style.main.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/css/docport.css>
<script src=/js/docport.js></script>
<script type=text/javascript>var baseurl="https://fangfeixiong.github.io/"</script>
</head>
<body data-url=/weixin-mini/>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<header>
<div>
<div class=burger>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a>
</div>
<div>
<a class=baselink href=https://fangfeixiong.github.io/>My New Hugo Site</a>
</div>
</div>
</header>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script>
<link href=/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://fangfeixiong.github.io/"</script>
<script type=text/javascript src=/js/search.js></script>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/ class="dd-item parent active haschildren
item_level_$level">
<i class="fas fa-chevron-down ddexp"></i>
<a href=/weixin-mini/>Weixin-minis</a>
<ul>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/tips_2/ class="dd-item
item_level_$level">
<a href=/weixin-mini/tips_2/>微信小程序开发Tips_2</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/tips_1/ class="dd-item
item_level_$level">
<a href=/weixin-mini/tips_1/>微信小程序开发Tips_1</a>
</li>
</ul>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/ class="dd-item haschildren
item_level_$level">
<i class="fas fa-chevron-right ddexp"></i>
<a href=/ios/>IOS</a>
<ul>
<li data-nav-id=https://fangfeixiong.github.io/ios/fmdb-use/ class="dd-item
item_level_$level">
<a href=/ios/fmdb-use/>FMDB的使用</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/privacy/ class="dd-item
item_level_$level">
<a href=/ios/privacy/>iOS 隐私使用说明（Privacy Usage Description）</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/reachability/ class="dd-item
item_level_$level">
<a href=/ios/reachability/>iOS判断是否连接网络</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/doubleclick-input-scalechange/ class="dd-item
item_level_$level">
<a href=/ios/doubleclick-input-scalechange/>WKWebView 禁用双击缩放和横向滚动</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/is-ipad/ class="dd-item
item_level_$level">
<a href=/ios/is-ipad/>判断当前设备是否是iPad</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/in-app-purchase/ class="dd-item
item_level_$level">
<a href=/ios/in-app-purchase/>苹果内购流程</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/visitor-can-recharge/ class="dd-item
item_level_$level">
<a href=/ios/visitor-can-recharge/>苹果审核，关于未登录时购买内容，引导登录时需要提供游客充值的入口</a>
</li>
</ul>
</li>
</ul>
</aside>
<section class=page>
<nav id=ariane aria-label=breadcrumb>
<ol class=ariane>
<li>
<a class=text-link href=https://fangfeixiong.github.io/>
Home
</a>
</li>
<li>
<a class=text-link href=/weixin-mini/>
Weixin-minis
</a>
</li>
<li class=active>
微信小程序开发Tips_2
</li>
</ol>
</nav>
<h1>微信小程序开发Tips_2</h1>
<div class=jump-to-section>
<span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})">
<span class="fas fa-align-right"></span>
Jump to Section
<i class="fas fa-chevron-right"></i>
</span>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=content>
<h4 ref=微信小程序分享到android朋友圈的beta版功能的使用问题>微信小程序分享到Android朋友圈的Beta版功能的使用问题</h4><a class=anchor id=微信小程序分享到android朋友圈的beta版功能的使用问题></a>
<ul>
<li>现在做的小程序的项目详情页引用了很多<strong>第三方的组件</strong>，导致分享到朋友圈的落地页无法完整显示，因为微信分享到朋友圈功能只能<strong>支持部分微信小程序的原生组件</strong>(详情见: <a href=https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share-timeline.html>微信官方文档分享到朋友圈Beta</a>)
</li>
<li>分享到朋友圈的页面路径是固定无法更改的，从<strong>页面A</strong>唤起的分享到朋友圈，朋友圈进入的落地页就展示的<strong>页面A</strong>的内容，点击<strong>前往小程序</strong>也会进入<strong>页面A</strong>。</li>
</ul>
<blockquote>
<p>那么如何将很复杂的页面分享到朋友圈，又能解决朋友圈进入的落地页按照预期的显示，不会错乱了。我做了如下一系列操作，这个思路供大家参考，如果有更好的方法大家可以给我留言哦！</p>
</blockquote>
<blockquote>
<h4 ref=第一步>第一步</h4><a class=anchor id=第一步></a>
<p>能够唤起朋友圈的分享，我习惯在onLoad的时候调用 <strong><a href=https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.showShareMenu.html>showShareMenu</a></strong> 方法，代码如下:
注意 <strong>shareTimeline</strong> 只对Android起作用。</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>   <span style=color:#a6e22e>onLoad</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>options</span>) {
        <span style=color:#75715e>//同时给分享菜单加入 分享给朋友 和 分享给朋友圈
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>showShareMenu</span>({
            <span style=color:#a6e22e>menus</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;shareAppMessage&#34;</span>, <span style=color:#e6db74>&#34;shareTimeline&#34;</span>]
        });
   }
</code></pre></div><blockquote>
<h4 ref=第二步>第二步</h4><a class=anchor id=第二步></a>
<p>实现页面时间处理函数 <strong><a href=https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareTimeline>onShareTimeline</a></strong> , 这个函数是返回自定义的分享内容, 分享的标题、自定义的额参数和分享的图片等。
<em>1.</em> 返回的 <strong>query</strong> 属性是页面路径携带的参数，不是页面路径哦，之前我这里理解错误，导致做了很多无用功。
<em>2.</em> 这里的 <strong>query</strong> 我携带了两个参数:
<em>target_id</em>: 分享的页面需要的参数，用来请求详情数据
<em>is_timeline</em>: 用来判断是否是朋友圈加载的落地页或者 <strong>前往小程序</strong> 按钮进入的</p>
<p>具体代码如下:</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>   <span style=color:#a6e22e>onShareTimeline</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>() {
       <span style=color:#66d9ef>return</span> {
           <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;分享标题&#39;</span>,
           <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;target_id=1&amp;is_timeline=1&#39;</span>,
           <span style=color:#a6e22e>image</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://path.jpg&#39;</span>,
       }
   }
</code></pre></div><blockquote>
<h4 ref=第三步>第三步</h4><a class=anchor id=第三步></a>
<p>修改 <strong>data</strong> 和 <strong>onLoad</strong> 函数</p>
<ol>
<li>给 <strong>data</strong> 中加入 is_timeline 属性，用来判断是小程序环境 还是 从朋友圈加载或进入的</li>
</ol>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js> <span style=color:#a6e22e>Page</span>({
   <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
       <span style=color:#a6e22e>is_timeline</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
   }
 })
</code></pre></div><blockquote>
<ol start=2>
<li>在 <strong>onLoad</strong> 函数中，获取内容详情id 和 是否是朋友圈的参数</li>
</ol>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>   <span style=color:#a6e22e>onLoad</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>options</span>) {
        <span style=color:#75715e>//同时给分享菜单加入 分享给朋友 和 分享给朋友圈
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>wx</span>.<span style=color:#a6e22e>showShareMenu</span>({
            <span style=color:#a6e22e>menus</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;shareAppMessage&#34;</span>, <span style=color:#e6db74>&#34;shareTimeline&#34;</span>]
        });
        <span style=color:#75715e>//获取是否是朋友圈的参数
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>is_timeline</span>) {
            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setdata</span>({<span style=color:#a6e22e>is_timeline</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>is_timeline</span>})
        }
        <span style=color:#75715e>//获取内容
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>getInfo</span>(<span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>target_id</span>)

   },

   <span style=color:#75715e>//获取信息内容
</span><span style=color:#75715e></span>   <span style=color:#a6e22e>getInfo</span>(<span style=color:#a6e22e>info_id</span>) {

   }
</code></pre></div><blockquote>
<h4 ref=第四步>第四步</h4><a class=anchor id=第四步></a>
<p>修改WXML文件，将朋友圈落地页需要展示的效果布局和信息页原本的布局区分开，而且朋友圈落地页效果使用微信开发文档支持的组件。</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>wx:if</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{is_timeline}}&#34;</span>&gt;
    信息的朋友圈落地页展示内容
      &lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>bindtap</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tapTimelineDetail&#34;</span>&gt;前往详情&lt;/<span style=color:#f92672>view</span>&gt;
  &lt;/<span style=color:#f92672>view</span>&gt;
&lt;/<span style=color:#f92672>view</span>&gt;
&lt;<span style=color:#f92672>view</span> <span style=color:#a6e22e>wx:else</span>&gt;
    信息的正式版本内容
&lt;/<span style=color:#f92672>view</span>&gt;
</code></pre></div><blockquote>
<h4 ref=第五步>第五步</h4><a class=anchor id=第五步></a>
<p>增加去详情的点击事件，点击前往详情后可以选择切换显示 或者使用 <strong>wx.redirectTo</strong> 关闭所有，跳转到新的详情页</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>   <span style=color:#a6e22e>tapTimelineDetail</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
       <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({<span style=color:#a6e22e>is_timeline</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>})
       <span style=color:#75715e>//或者
</span><span style=color:#75715e></span>       <span style=color:#75715e>//wx.redirectTo({url: path})
</span><span style=color:#75715e></span>   }
</code></pre></div><blockquote>
<p>到这里就算完成了，下面是实际使用的效果。如果有其他的解决方案可以给我留言哦！</p>
</blockquote>
<video id=video controls preload=none poster=tips2.jpeg width=100%>
<source id=mp4 src=tip2.mp4 type=video/mp4>
</video>
</div>
<div class=chevrons>
<a class=next href=/weixin-mini/tips_1/ title=微信小程序开发Tips_1 style=margin-right:0>
<div>
<p>Next page</p>
<label>微信小程序开发Tips_1</label>
</div>
<i class="fas fa-arrow-right" style=font-size:1.7em></i></a>
</div>
</section>
<section class=right-menu>
<div class=TableOfContents>
<label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label>
<nav>
<ul>
<li><a href=/weixin-mini/>Weixin-minis</a></li>
</ul>
</nav>
</div>
<div class=Actions>
<nav>
<ul>
<li>
<i class="fas fa-calendar"></i>
Last update on 31 August 2021
</li>
</ul>
</nav>
</div>
</section>
</article>
<footer>
Create a content/_layout/footer/_index.md file to customize the footer content !
</footer>
</body>
</html>