<!doctype html><html>
<head>
<title></title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2021-09-24T09:01:16 UTC">
<meta name=description content>
<title>iOS开发 :: 放飞熊的博客</title>
<link rel="shortcut icon" href=/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/layout.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/css/style.main.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://fangfeixiong.github.io/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/css/docport.css>
<script src=/js/docport.js></script>
<script type=text/javascript>var baseurl="https://fangfeixiong.github.io/"</script>
</head>
<body data-url=/categories/ios%E5%BC%80%E5%8F%91/>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<header>
<div>
<div class=burger>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a>
</div>
<div>
<a class=baselink href=https://fangfeixiong.github.io/>放飞熊的博客</a>
</div>
</div>
</header>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script>
<link href=/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://fangfeixiong.github.io/"</script>
<script type=text/javascript src=/js/search.js></script>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
<li data-nav-id=https://fangfeixiong.github.io/unity3d/ class="dd-item haschildren
item_level_$level">
<i class="fas fa-chevron-right ddexp"></i>
<a href=/unity3d/>Unity3ds</a>
<ul>
<li data-nav-id=https://fangfeixiong.github.io/unity3d/flutter-unity-view-wiget/ class="dd-item
item_level_$level">
<a href=/unity3d/flutter-unity-view-wiget/>flutter-unity-view-widget使用问题和解决办法汇总</a>
</li>
</ul>
</li>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/ class="dd-item haschildren
item_level_$level">
<i class="fas fa-chevron-right ddexp"></i>
<a href=/weixin-mini/>Weixin-minis</a>
<ul>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/tips_2/ class="dd-item
item_level_$level">
<a href=/weixin-mini/tips_2/>微信小程序开发Tips_2</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/weixin-mini/tips_1/ class="dd-item
item_level_$level">
<a href=/weixin-mini/tips_1/>微信小程序开发Tips_1</a>
</li>
</ul>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/ class="dd-item haschildren
item_level_$level">
<i class="fas fa-chevron-right ddexp"></i>
<a href=/ios/>IOS</a>
<ul>
<li data-nav-id=https://fangfeixiong.github.io/ios/fmdb-use/ class="dd-item
item_level_$level">
<a href=/ios/fmdb-use/>FMDB的使用</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/privacy/ class="dd-item
item_level_$level">
<a href=/ios/privacy/>iOS 隐私使用说明（Privacy Usage Description）</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/reachability/ class="dd-item
item_level_$level">
<a href=/ios/reachability/>iOS判断是否连接网络</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/doubleclick-input-scalechange/ class="dd-item
item_level_$level">
<a href=/ios/doubleclick-input-scalechange/>WKWebView 禁用双击缩放和横向滚动</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/is-ipad/ class="dd-item
item_level_$level">
<a href=/ios/is-ipad/>判断当前设备是否是iPad</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/in-app-purchase/ class="dd-item
item_level_$level">
<a href=/ios/in-app-purchase/>苹果内购流程</a>
</li>
<li data-nav-id=https://fangfeixiong.github.io/ios/visitor-can-recharge/ class="dd-item
item_level_$level">
<a href=/ios/visitor-can-recharge/>苹果审核，关于未登录时购买内容，引导登录时需要提供游客充值的入口</a>
</li>
</ul>
</li>
</ul>
</aside>
<section class=page>
<div class="extra-pagination inner">
<nav class=pagination role=navigation>
<span class=page-number>Page 1 of 1</span>
</nav>
</div>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/fmdb-use/>FMDB的使用</a></h2>
</header>
<section class=post-excerpt>
<p>FMDB的使用 最近app中使用了苹果支付来充值，然后苹果支付结果是直接返回给客户端的，而不像支付宝和微信支付等支付平台，支付完成后会回调后台。
苹果支付返回的结果是一个超级长的ReceiveData的字符串。然后得到字符串之后向自己的后台发请求，让自己的后台去请求苹果的服务器来校验结果。当然也可以客服端直接调用苹果的服务器来的到校验结果，然后发给自己的服务器，但是这显然是不靠谱的，容易被篡改。所以还是让自己的服务端去校验，才比较靠谱。
这里我们会遇到一个问题，如果我们得到苹果的支付结果后，还没来得及发给自己的后端校验，遇到突然就断网了，app崩溃了，手机没电关机了等情况。那我们得到的支付结果ReceiveData就直接丢失了，再也找不到了，用户充了钱，却没有得到应有的虚拟货币，那就尴尬了。
所以了我们就想到一个方案，收到苹果的支付结果后，先把他存储在本地。然后向自己的后端发出请求，如果自己的服务端校验完成，返回结果后，就把本地存储的对应的记录删除掉。
每次app开启的时候，查询所有未校验的支付结果，依次发给自己的服务端进行校验，这样就不会漏掉了。当然数据可以以文件的形式存储，但是作者觉得用数据库存储可能更方便一些，以后可能也会有其他的数据需要存储，所以就决定学习一下FMDB的使用。FMDB可以直接通过CocosPod 下载集成，很方便。
先定义一些常量，比如数据库名、表名、列名，方便后面操作的引用。 //数据库名 #define DataBase_Name @"yourDataBaseName.sqlite" //表名 #define TableName_Table1 @"table1" //列1 名称 #define Table1_ColumnName1 @"columnName1" //列2 名称 #define Table1_ColumnName2 @"columnName2" //列3 名称 #define Table1_ColumnName3 @"columnName3" 1.创建数据库 NSString *documentPath=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject]; NSString *databasePath=[documentPath stringByAppendingPathComponent:DataBase_Name]; FMDatabase *database=[FMDatabase databaseWithPath:databasePath]; 2.创建表 if([database open]) { BOOL createTableResult=[database executeUpdate: [NSString stringWithFormat:@"create table %@ (%@ text,%@ text,%@ integer)",TableName_Table1,Table1_ColumnName1,Table1_ColumnName2,Table1_ColumnName3]]; [database close]; } 3. <a class=read-more href=/ios/fmdb-use/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/privacy/>iOS 隐私使用说明（Privacy Usage Description）</a></h2>
</header>
<section class=post-excerpt>
<p>遇到问题 今天遇到了一个很奇怪的问题，App 的新版发布好了，用 Xcode 上传到 App Store 显示 Success 的标志了。却在 iTunesConnect 的对应 App 的活动>构建版本中，怎么也找不到了。然后修改了 build 的版本号，重现打包上传了好几依然找不到，这让我百思不得其解，完全懵逼！
试着搜索 Xcode 打包上传成功 构建版本中找不到，有很多人遇到了同样的问题，原来都是 隐私使用说明没有设置惹得祸呀。
然后翻阅一下官方文档对应的信息 App Programming Guide for iOS 看到了 The Information Property List File下的一段信息
Apps must provide purpose strings (sometimes called “usage descriptions”) for accessing user data and certain app features. When there is a privacy concern about an app accessing user data or device capabilities, iOS prompts the user and requests permission on behalf of your app. <a class=read-more href=/ios/privacy/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/reachability/>iOS判断是否连接网络</a></h2>
</header>
<section class=post-excerpt>
<p>content {:toc} 遇到的问题 iOS10 以上的系统，第一次下载一个app的时候会出现这样一个问题。当用户还没有选择是否允许使用wifi和蜂窝网络的时候，如果这时候已经进入app的主界面，那么就会所有的数据访问失败，导致界面一片空白，没有任何数据。这时如果用户选择了允许访问wifi和蜂窝网络后，没有一个像允许通知的api，来通知app网络已经连接上了。
为了解决这个问题，我们需要自己来监听网络环境是否有变化，如果监听到变化了，知道网络已经连接上，这时重新请求数据就能够获取到了，然后将app的主界面填充起来！
监听网络环境的iOS没有现有的Api供调用，但是苹果官方有个Demo里面有一个对应的类Reachability 获取项目
为了方便调用，我自己做了一个封装类 封装类地址
调用方式 {% highlight objective_c %}
[[ReachabilityManager Instance] setHostName:&ldquo;www.apple.com&rdquo; complete:^{ if([[ReachabilityManager Instance] canReachHttp]) { 请求你自己的数据; [[ReachabilityManager Instance] stop]; } }]; if([[ReachabilityManager Instance] canReachHttp]) { 请求你自己的数据; [[ReachabilityManager Instance] stop]; }else { [[ReachabilityManager Instance] start]; } {% endhighlight %} <a class=read-more href=/ios/reachability/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/doubleclick-input-scalechange/>WKWebView 禁用双击缩放和横向滚动</a></h2>
</header>
<section class=post-excerpt>
<p>遇到问题 WKWebView 加载h5的小说阅读页面
放大缩小手势会放大和缩小网页，这是我们不需要的！
当点击放大字体和缩小字体时，双击就会导致网页整体放大！如下图所示：
解决问题 WKWebView 禁用 Zoom self.webView.scrollView.alwaysBounceVertical = YES; self.webView.scrollView.showsHorizontalScrollIndicator = NO; self.webView.scrollView.bouncesZoom = NO; Html 的放大缩小禁用 加入顶部 DOCTYPE dtd &lt;!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd"> 加入meta 禁止缩放的信息 &lt;meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"> Input 标签的替换 上面的方法都做了之后，双击A+ 、A- 按钮的时候，WebView还是被放大了。然后我就去看传过来的Html源码了，发现 我们的 A+ 、A- 按钮为了做按钮样式方便, 都是使用的 Input 标签，然后我们把 Input 标签都换成了 div 标签。这样问题就彻底解决了！ <a class=read-more href=/ios/doubleclick-input-scalechange/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/is-ipad/>判断当前设备是否是iPad</a></h2>
</header>
<section class=post-excerpt>
<p>判断当前设备是否是iPad 1.不靠谱的判断 ```objc [UIDevice currentDevice].userInterfaceIdiom==UIUserInterfaceIdiomPad ``` 判断是否是iPad不靠谱，如果是只支持iPhone的程序，在iPad上运行了，这个判断是NO。 2.靠谱的判断 ```objc [[UIDevice currentDevice].model isEqualToString:@"iPad"] ``` <a class=read-more href=/ios/is-ipad/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/in-app-purchase/>苹果内购流程</a></h2>
</header>
<section class=post-excerpt>
<p>登录iTunesconnect 1.登录iTunes Connect
协议、税务和银行业务 信息完善 1.选择协议、税务和银行业务项，如下图所示 2.选择Request 按照一步步操作即可,等待审核（需要一点时间可以过一天再看），完毕后即可得到上图Contracts In Effects的一条PaidApplication信息！
3.编辑联系信息 所有的信息填写同一个人即可
4.税务信息 5.银行信息填写 CNAPS Code 银行网点联行号 查询网址 需要哪个银行直接去对应银行链接里面找就行
所有信息填写完毕后我们就可以开始编辑内购项
编辑内购项 1.进入iTunes Connect 首界面，选择我的App，选中你需要加入内购的App。
2.内购项目 点击+按钮添加自己的内购项目
比如我们的应用是虚拟货币，所以我们选择消耗型,根据需要选择对应的类型，如下图
填写内购项的信息 这里注意图片对应app内部的相应的选项 内购代码 1.从自己的服务器上获取充值选项数据，用于展示选择项，每一项对应一个内购项目,带有内购项的ID信息
2.向苹果服务器请求内购信息，根据内购项的ID列表
-(void)requestAppleProducts{ SKProductsRequest *productsRequest=[[SKProductsRequest alloc] initWithProductIdentifiers:[NSSet setWithArray:@[你的内购项的ID列表]]; productsRequest.delegate=self; [productsRequest start]; } -(void)productsRequest:(SKProductsRequest *)request didReceiveResponse:(SKProductsResponse *)response { NSArray&lt;SKProduct*> *products=[response.products sortedArrayWithOptions:NSSortConcurrent usingComparator:^NSComparisonResult(SKProduct obj1, SKProduct obj2) { return [obj1.price compare:obj2.price]; }]; } 3.选择一个充值项，充值调用
//请求充值 -(void)requestPurchase { //监听内购处理过程 [[SKPaymentQueue defaultQueue] addTransactionObserver:self]; SKProduct *product=选中的项对应的product; SKPayment *payment=[SKPayment paymentWithProduct:product]; [[SKPaymentQueue defaultQueue] addPayment:payment];//执行内购 } //内购支付结果处理 -(void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray&lt;SKPaymentTransaction *> *)transactions { for(SKPaymentTransaction *transation in transactions){ switch (transation. <a class=read-more href=/ios/in-app-purchase/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<article class="post iOS">
<header class=post-header>
<h2 class=post-title><a href=/ios/visitor-can-recharge/>苹果审核，关于未登录时购买内容，引导登录时需要提供游客充值的入口</a></h2>
</header>
<section class=post-excerpt>
<p>遇到问题 嗨糖 1.2.2 提交审核被苹果拒了，原因是 用户购买内容时，强制用户登录后充值，而没有提供游客充值的入口。 如下图所示： 点击 去登录按钮后, 我们直接跳转到了登录页面，这个是不允许的。 解决问题 按照苹果的规则，我们在点击去登录按钮后，加了一个中间提示选择界面。提示用户登录后充值才是有效充值，未登录情况下的充值将不会被记录，明确告知用户风险。
然后提供了 游客充值 或 登录两个入口，游客充值按钮 尽量的小而且不显眼，因为那里进入充值也是白充的。然后把登录做的大一些，尽量显眼，让用户知道要点击登录按钮，才是正确的。
如下图所示：
游客充值： 会直接跳转到充值也，可以完整的走通苹果的充值流程，但是结果我们不会发给后端也不会存储。因为我们完全不知道它是谁。
登录：跳转到登录页面，登录成功后，制动返回当前章节页。
<a class=read-more href=/ios/visitor-can-recharge/>&#187;</a></p>
</section>
<footer class=footline>
</footer>
</article>
<div style=margin-bottom:2rem></div>
<nav class=pagination role=navigation>
<span class=page-number>Page 1 of 1</span>
</nav>
</section>
<section class=right-menu>
</section>
</article>
<footer>
Create a content/_layout/footer/_index.md file to customize the footer content !
</footer>
</body>
</html>